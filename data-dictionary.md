# Data Dictionary
# Marketing Analytics Data Warehouse - Complete Column Specifications

**Project:** Multi-Source Marketing & Sales Analytics Platform  
**Platform:** Matillion + Snowflake  
**Version:** 1.0  
**Date:** 2025-12-21  
**Status:** Design Complete

---

## Table of Contents

1. [Overview](#1-overview)
2. [Naming Conventions](#2-naming-conventions)
3. [Internal Stages (RAW Layer)](#3-internal-stages-raw-layer)
4. [Bronze Tables](#4-bronze-tables)
5. [Silver/ODS Tables](#5-silverods-tables)
6. [Gold Layer Views](#6-gold-layer-views)
7. [Sequences](#7-sequences)
8. [Quick Reference](#8-quick-reference)

---

## 1. Overview

### 1.1 Purpose

This data dictionary provides complete column-level documentation for all 31 database objects in the marketing analytics data warehouse.

### 1.2 Object Count Summary

| Layer | Object Type | Count | Naming Pattern |
|-------|-------------|-------|----------------|
| **RAW** | Internal Stages | 6 | `mtln_stage_<entity>` |
| **Bronze** | Tables | 6 | `mtln_bronze_<entity>` |
| **Silver/ODS** | Tables | 6 | `mtln_ods_<entity>` |
| **Silver/ODS** | Sequences | 6 | `mtln_ods_<entity>_seq` |
| **Gold** | Views (Dimensions) | 5 | `mtln_dim_<entity>` |
| **Gold** | Views (Facts) | 2 | `mtln_fact_<entity>` |
| **Total** | | **31** | |

### 1.3 Data Flow

```
Parquet Files → RAW Stages → Bronze Tables → Silver/ODS Tables → Gold Views → BI Tools
                (landing)     (as-is)       (clean + SKs)     (star schema)  (analytics)
```

---

## 2. Naming Conventions

### 2.1 Object Names

- **Prefix:** All objects start with `mtln_` (project namespace)
- **Layer indicator:** `stage`, `bronze`, `ods`, `dim`, `fact`
- **Entity name:** Singular for dimensions, plural for sources
- **Sequences:** End with `_seq`

**Examples:**
- `mtln_stage_campaigns` - RAW stage
- `mtln_bronze_campaigns` - Bronze table
- `mtln_ods_campaigns` - Silver/ODS table
- `mtln_ods_campaigns_seq` - Sequence for surrogate keys
- `mtln_dim_campaign` - Gold dimension view (singular)
- `mtln_fact_sales` - Gold fact view (plural)

### 2.2 Column Names

**Surrogate Keys:**
- Pattern: `<table>_sk` or `surrogate_key`
- Type: NUMBER (generated by sequence)
- Example: `dim_campaign_sk`, `surrogate_key`

**Natural Keys:**
- Pattern: `<entity>_id` or `natural_key`
- Type: VARCHAR
- Example: `campaign_id`, `natural_key`

**Foreign Keys:**
- Pattern: `<referenced_table>_sk`
- Type: NUMBER
- Example: `dim_customer_sk`, `campaign_surrogate_key`

**Audit Columns:**
- `load_timestamp` - When record loaded
- `source_system` - Source system identifier
- `last_modified_timestamp` - Source system update time

### 2.3 Data Types

| Data Type | Use Case | Example |
|-----------|----------|----------|
| `NUMBER(38,0)` | Surrogate keys, IDs | `surrogate_key` |
| `VARCHAR(255)` | Text fields | `campaign_name` |
| `NUMBER(18,2)` | Currency, decimals | `budget`, `revenue` |
| `NUMBER(10,4)` | Percentages | `margin_percent`, `ctr` |
| `DATE` | Date values | `start_date`, `performance_date` |
| `TIMESTAMP_NTZ` | Timestamps | `load_timestamp` |
| `BOOLEAN` | True/false flags | `is_weekend`, `is_active` |

---

## 3. Internal Stages (RAW Layer)

### Purpose

Temporary landing zones for Parquet files uploaded from source systems.

### Common Specifications

- **File Format:** Parquet (compressed, columnar)
- **Retention:** 7 days (auto-purge after Bronze load)
- **Encryption:** Snowflake default (AES-256)
- **Access:** Data engineering team only

---

### 3.1 mtln_stage_campaigns

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_campaigns
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for campaign data files';
```

**Expected File Structure:**
- Files: `campaigns_YYYYMMDD.parquet`
- Columns: campaign_id, campaign_name, campaign_type, start_date, end_date, budget, status, objective, last_modified_timestamp

---

### 3.2 mtln_stage_customers

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_customers
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for customer data files';
```

**Expected File Structure:**
- Files: `customers_YYYYMMDD.parquet`
- Columns: customer_id, customer_name, email, phone, segment, tier, status, lifetime_value, last_modified_timestamp

---

### 3.3 mtln_stage_products

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_products
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for product data files';
```

**Expected File Structure:**
- Files: `products_YYYYMMDD.parquet`
- Columns: product_id, sku, product_name, category, subcategory, brand, unit_price, cost, margin, margin_percent, product_status, last_modified_timestamp

---

### 3.4 mtln_stage_sales

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_sales
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for sales transaction files';
```

**Expected File Structure:**
- Files: `sales_YYYYMMDD.parquet`
- Columns: order_id, order_line_id, customer_id, product_id, campaign_id, order_date, order_timestamp, quantity, unit_price, discount_amount, tax_amount, line_total, revenue, last_modified_timestamp

---

### 3.5 mtln_stage_performance

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_performance
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for marketing performance metric files';
```

**Expected File Structure:**
- Files: `performance_YYYYMMDD.parquet`
- Columns: performance_id, campaign_id, channel_id, performance_date, impressions, clicks, cost, conversions, revenue, last_modified_timestamp

---

### 3.6 mtln_stage_channels

**DDL:**
```sql
CREATE OR REPLACE STAGE mtln_stage_channels
    FILE_FORMAT = (TYPE = 'PARQUET')
    COPY_OPTIONS = (ON_ERROR = 'CONTINUE')
    COMMENT = 'Landing stage for channel reference data files';
```

**Expected File Structure:**
- Files: `channels_YYYYMMDD.parquet`
- Columns: channel_id, channel_name, channel_type, category, cost_structure, last_modified_timestamp

---

## 4. Bronze Tables

### Purpose

Raw relational copy of source data - as-is from Parquet files, no transformations.

### Common Specifications

- **Load Strategy:** Full refresh (TRUNCATE + INSERT)
- **Retention:** 14 days
- **Table Type:** TRANSIENT (25% storage cost savings)
- **Purpose:** Technical audit trail

---

### 4.1 mtln_bronze_campaigns

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| campaign_id | VARCHAR(100) | NOT NULL | Unique campaign identifier | 'CPG2025001' |
| campaign_name | VARCHAR(255) | NULL | Campaign display name | 'Q1 2025 Brand Awareness' |
| campaign_type | VARCHAR(100) | NULL | Campaign category | 'Brand', 'Performance', 'Retargeting' |
| start_date | DATE | NULL | Campaign start date | 2025-01-01 |
| end_date | DATE | NULL | Campaign end date | 2025-03-31 |
| budget | NUMBER(18,2) | NULL | Total campaign budget ($) | 50000.00 |
| status | VARCHAR(50) | NULL | Current status | 'Active', 'Paused', 'Completed' |
| objective | VARCHAR(255) | NULL | Business objective | 'Increase brand awareness by 20%' |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source system update time | 2025-12-21 10:30:00 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | When loaded to Bronze | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system name | 'MARKETING_PLATFORM' |

**Primary Key:** campaign_id (natural key)  
**Row Count:** ~1,000 campaigns  
**Load Frequency:** Daily full refresh

### 4.2 mtln_bronze_customers

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| customer_id | VARCHAR(100) | NOT NULL | Unique customer identifier | 'CUST100234' |
| customer_name | VARCHAR(255) | NULL | Customer full name | 'John Smith' |
| email | VARCHAR(255) | NULL | Email address | 'john.smith@example.com' |
| phone | VARCHAR(50) | NULL | Phone number | '+1-555-0123' |
| segment | VARCHAR(100) | NULL | Market segment | 'Enterprise', 'SMB', 'Consumer' |
| tier | VARCHAR(50) | NULL | Customer tier | 'Platinum', 'Gold', 'Silver', 'Bronze' |
| status | VARCHAR(50) | NULL | Customer status | 'Active', 'Inactive', 'Churned' |
| lifetime_value | NUMBER(18,2) | NULL | Total LTV ($) | 25000.00 |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source update time | 2025-12-21 11:00:00 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | Bronze load time | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system | 'CRM' |

**Primary Key:** customer_id  
**Row Count:** ~500,000 customers  
**Load Frequency:** Daily full refresh

### 4.3 mtln_bronze_products

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| product_id | VARCHAR(100) | NOT NULL | Unique product identifier | 'PROD-12345' |
| sku | VARCHAR(100) | NULL | Stock keeping unit | 'SKU-ABC-XYZ-001' |
| product_name | VARCHAR(255) | NULL | Product name | 'Premium Widget Pro' |
| category | VARCHAR(100) | NULL | Product category | 'Electronics', 'Apparel', 'Home' |
| subcategory | VARCHAR(100) | NULL | Product subcategory | 'Smartphones', 'Laptops' |
| brand | VARCHAR(100) | NULL | Brand name | 'TechBrand' |
| unit_price | NUMBER(18,2) | NULL | Selling price ($) | 299.99 |
| cost | NUMBER(18,2) | NULL | Cost to produce ($) | 180.00 |
| margin | NUMBER(18,2) | NULL | Profit margin ($) | 119.99 |
| margin_percent | NUMBER(10,4) | NULL | Margin % | 40.0000 |
| product_status | VARCHAR(50) | NULL | Product status | 'Active', 'Discontinued' |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source update time | 2025-12-21 10:00:00 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | Bronze load time | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system | 'ERP' |

**Primary Key:** product_id  
**Row Count:** ~10,000 products  
**Load Frequency:** Daily full refresh

### 4.4 mtln_bronze_sales

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| order_id | VARCHAR(100) | NOT NULL | Unique order identifier | 'ORD-2025-001234' |
| order_line_id | VARCHAR(100) | NOT NULL | Order line item identifier | 'ORD-2025-001234-001' |
| customer_id | VARCHAR(100) | NULL | Customer FK | 'CUST100234' |
| product_id | VARCHAR(100) | NULL | Product FK | 'PROD-12345' |
| campaign_id | VARCHAR(100) | NULL | Campaign FK (attribution) | 'CPG2025001' |
| order_date | DATE | NULL | Order date | 2025-01-15 |
| order_timestamp | TIMESTAMP_NTZ | NULL | Exact order timestamp | 2025-01-15 14:23:45 |
| quantity | NUMBER(10,0) | NULL | Units ordered | 2 |
| unit_price | NUMBER(18,2) | NULL | Price per unit | 299.99 |
| discount_amount | NUMBER(18,2) | NULL | Discount applied | 30.00 |
| tax_amount | NUMBER(18,2) | NULL | Sales tax | 48.00 |
| line_total | NUMBER(18,2) | NULL | Line subtotal | 569.98 |
| revenue | NUMBER(18,2) | NULL | Net revenue (line_total + tax - discount) | 587.98 |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source update time | 2025-01-15 14:23:50 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | Bronze load time | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system | 'ECOMMERCE' |

**Primary Key:** order_line_id  
**Foreign Keys:** customer_id, product_id, campaign_id (natural keys)  
**Row Count:** ~5,000,000 order lines  
**Load Frequency:** Daily full refresh

### 4.5 mtln_bronze_performance

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| performance_id | VARCHAR(100) | NOT NULL | Unique performance record ID | 'PERF-2025-001234' |
| campaign_id | VARCHAR(100) | NULL | Campaign FK | 'CPG2025001' |
| channel_id | VARCHAR(100) | NULL | Channel FK | 'CH-EMAIL' |
| performance_date | DATE | NULL | Metric date | 2025-01-15 |
| impressions | NUMBER(18,0) | NULL | Total impressions | 100000 |
| clicks | NUMBER(18,0) | NULL | Total clicks | 2500 |
| cost | NUMBER(18,2) | NULL | Ad spend ($) | 500.00 |
| conversions | NUMBER(18,0) | NULL | Total conversions | 125 |
| revenue | NUMBER(18,2) | NULL | Revenue generated ($) | 2500.00 |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source update time | 2025-01-15 23:59:59 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | Bronze load time | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system | 'AD_PLATFORM' |

**Primary Key:** performance_id  
**Grain:** One row per campaign per channel per day  
**Row Count:** ~500,000 daily snapshots  
**Load Frequency:** Daily full refresh

### 4.6 mtln_bronze_channels

| Column | Data Type | NULL | Description | Sample Value |
|--------|-----------|------|-------------|-------------|
| channel_id | VARCHAR(100) | NOT NULL | Unique channel identifier | 'CH-EMAIL' |
| channel_name | VARCHAR(255) | NULL | Channel display name | 'Email Marketing' |
| channel_type | VARCHAR(100) | NULL | Channel type | 'Email', 'Display', 'Search', 'Social' |
| category | VARCHAR(100) | NULL | Channel category | 'Owned', 'Paid', 'Earned' |
| cost_structure | VARCHAR(100) | NULL | Pricing model | 'CPC', 'CPM', 'Fixed' |
| last_modified_timestamp | TIMESTAMP_NTZ | NULL | Source update time | 2025-01-01 00:00:00 |
| load_timestamp | TIMESTAMP_NTZ | NOT NULL | Bronze load time | 2025-12-21 12:00:00 |
| source_system | VARCHAR(50) | NOT NULL | Source system | 'MARKETING_PLATFORM' |

**Primary Key:** channel_id  
**Row Count:** ~20 channels  
**Load Frequency:** Daily full refresh

---

## 5. Silver/ODS Tables

### Purpose

Clean operational data store - validated, deduplicated, with surrogate keys.

### Common Specifications

- **Load Strategy:** Incremental (MERGE based on high water mark)
- **Retention:** 30 days
- **Table Type:** PERMANENT (Snowflake Time Travel enabled)
- **Surrogate Keys:** Generated by sequences
- **Purpose:** Clean operational queries + Gold layer source

---

### 5.1 mtln_ods_campaigns

**DDL:**
```sql
CREATE OR REPLACE TABLE mtln_ods_campaigns (
    surrogate_key             NUMBER(38,0) DEFAULT mtln_ods_campaigns_seq.NEXTVAL,
    campaign_id               VARCHAR(100) NOT NULL,
    campaign_name             VARCHAR(255) NOT NULL,
    campaign_type             VARCHAR(100) NOT NULL,
    start_date                DATE NOT NULL,
    end_date                  DATE NOT NULL,
    budget                    NUMBER(18,2) DEFAULT 0.00,
    status                    VARCHAR(50) DEFAULT 'Unknown',
    objective                 VARCHAR(255),
    last_modified_timestamp   TIMESTAMP_NTZ NOT NULL,
    load_timestamp            TIMESTAMP_NTZ DEFAULT CURRENT_TIMESTAMP(),
    source_system             VARCHAR(50) NOT NULL,
    CONSTRAINT pk_ods_campaigns PRIMARY KEY (surrogate_key),
    CONSTRAINT uk_ods_campaigns UNIQUE (campaign_id)
);
```

**Key Transformations from Bronze:**
- ✅ NULL handling: `COALESCE(campaign_name, 'Unknown')`
- ✅ Default values: `budget` defaults to 0.00
- ✅ NOT NULL constraints: Critical fields enforced
- ✅ Deduplication: `QUALIFY ROW_NUMBER() OVER (PARTITION BY campaign_id ORDER BY last_modified_timestamp DESC) = 1`
- ✅ Surrogate key: Auto-generated from sequence

**Load Strategy:** Incremental  
**High Water Mark:** `last_modified_timestamp`  
**Clustering:** `(campaign_id, start_date)`

---

### 5.2 mtln_ods_customers

**Key Columns:**
- `surrogate_key` (PK, from sequence)
- `customer_id` (natural key, unique)
- `customer_name`, `email`, `phone`
- `segment`, `tier`, `status`
- `lifetime_value`

**Transformations:**
- Email validation: `REGEXP_LIKE(email, '^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$', 'i')`
- Phone formatting: Strip non-numeric characters
- Tier normalization: Uppercase
- LTV defaulting: 0.00 if NULL

---

### 5.3 mtln_ods_products

**Key Columns:**
- `surrogate_key` (PK)
- `product_id` (natural key)
- `sku`, `product_name`, `category`, `subcategory`, `brand`
- `unit_price`, `cost`, `margin`, `margin_percent`

**Derived Columns:**
- `margin` = `unit_price` - `cost`
- `margin_percent` = (`margin` / `unit_price`) * 100

**Business Rules:**
- Price > 0
- Cost > 0
- Margin >= 0

---

### 5.4 mtln_ods_sales

**Key Columns:**
- `surrogate_key` (PK)
- `order_line_id` (natural key)
- `customer_surrogate_key` (FK to mtln_ods_customers)
- `product_surrogate_key` (FK to mtln_ods_products)
- `campaign_surrogate_key` (FK to mtln_ods_campaigns)
- `order_date`, `order_timestamp`
- `quantity`, `unit_price`, `discount_amount`, `tax_amount`
- `line_total`, `revenue`

**Business Rules:**
- `quantity` > 0
- `unit_price` >= 0
- `discount_amount` >= 0
- `line_total` = (`unit_price` × `quantity`) - `discount_amount`
- `revenue` = `line_total` + `tax_amount`

**Clustering:** `(order_date, customer_surrogate_key)`

---

### 5.5 mtln_ods_performance

**Key Columns:**
- `surrogate_key` (PK)
- `performance_id` (natural key)
- `campaign_surrogate_key` (FK)
- `channel_surrogate_key` (FK)
- `performance_date`
- `impressions`, `clicks`, `cost`, `conversions`, `revenue`
- `ctr`, `cpc`, `roas` (calculated)

**Calculated Metrics:**
```sql
ctr = (clicks / NULLIF(impressions, 0)) * 100
cpc = cost / NULLIF(clicks, 0)
roas = revenue / NULLIF(cost, 0)
```

**Business Rules:**
- `impressions` >= `clicks`
- `clicks` >= `conversions`
- `cost` >= 0
- `revenue` >= 0

**Clustering:** `(performance_date, campaign_surrogate_key)`

---

### 5.6 mtln_ods_channels

**Key Columns:**
- `surrogate_key` (PK)
- `channel_id` (natural key)
- `channel_name`, `channel_type`, `category`, `cost_structure`

**Load Strategy:** Full refresh (small reference table)

---

## 6. Gold Layer Views

### Purpose

Analytics-ready star schema - dimensions and facts optimized for BI tools.

### Common Specifications

- **Implementation:** Views (not tables)
- **Source:** Silver/ODS tables
- **Storage:** None (virtual)
- **Refresh:** Instant (always current)
- **SCD Type:** Type 1 (overwrite) for all dimensions
- **Target Users:** Business analysts, data scientists, BI tools

---

### 6.1 mtln_dim_campaign

**Purpose:** Campaign dimension

**Key Columns:**
- `dim_campaign_sk` (PK) - Surrogate key
- `natural_key` - Original campaign_id
- `campaign_name`, `campaign_type`, `campaign_budget`
- `campaign_start_date`, `campaign_end_date`
- `campaign_duration_days` (derived)
- `campaign_period_status` (derived: Current/Past/Future)
- `budget_category` (derived: High/Medium/Low)

**Source:** `mtln_ods_campaigns`

---

### 6.2 mtln_dim_customer

**Purpose:** Customer dimension

**Key Columns:**
- `dim_customer_sk` (PK)
- `natural_key` - Original customer_id
- `customer_name`, `customer_email`, `customer_segment`, `customer_tier`
- `customer_lifetime_value`
- `tier_rank` (derived: 1-5)
- `value_category` (derived: VIP/Premium/Standard/Basic)
- `is_active_customer` (derived boolean)

**Source:** `mtln_ods_customers`

---

### 6.3 mtln_dim_product

**Purpose:** Product dimension

**Key Columns:**
- `dim_product_sk` (PK)
- `natural_key` - Original product_id
- `product_sku`, `product_name`, `product_category`, `product_brand`
- `product_price`, `product_cost`, `product_margin`, `product_margin_percent`
- `margin_category` (derived: High/Medium/Low)
- `price_tier` (derived: Premium/Mid-Range/Budget)

**Source:** `mtln_ods_products`

---

### 6.4 mtln_dim_channel

**Purpose:** Marketing channel dimension

**Key Columns:**
- `dim_channel_sk` (PK)
- `natural_key` - Original channel_id
- `channel_name`, `channel_type`, `channel_category`
- `cost_structure`
- `channel_classification` (derived: Digital Paid/Digital Owned/Other)

**Source:** `mtln_ods_channels`

---

### 6.5 mtln_dim_date

**Purpose:** Calendar dimension

**Type:** Table (not view) - pre-populated

**Key Columns:**
- `date_key` (PK) - YYYYMMDD format
- `full_date` - Actual DATE value
- `year`, `quarter`, `month`, `month_name`
- `week`, `day_of_week`, `day_name`
- `is_weekend`, `is_holiday`
- `fiscal_year`, `fiscal_quarter`, `fiscal_period`

**Range:** 2020-01-01 to 2030-12-31 (3,653 rows)  
**Load:** One-time generation

---

### 6.6 mtln_fact_sales

**Purpose:** Sales transaction fact table

**Grain:** One row per order line item

**Foreign Keys:**
- `dim_customer_sk`
- `dim_product_sk`
- `dim_campaign_sk`
- `dim_date_sk` (from order_date)
- `dim_time_sk` (from order_timestamp, HHMMSS format)

**Measures (Additive):**
- `quantity`
- `unit_price`
- `discount_amount`
- `tax_amount`
- `line_total`
- `revenue`

**Natural Keys (for drill-through):**
- `order_id`
- `order_line_id`
- `transaction_timestamp`

**Source:** `mtln_ods_sales`

---

### 6.7 mtln_fact_performance

**Purpose:** Marketing performance fact table

**Grain:** One row per campaign per channel per day

**Foreign Keys:**
- `dim_campaign_sk`
- `dim_channel_sk`
- `dim_date_sk`

**Measures:**
- **Additive:** `impressions`, `clicks`, `cost`, `conversions`, `revenue`
- **Calculated (semi-additive):** `ctr`, `cpc`, `roas`

**Natural Keys:**
- `performance_id`
- `performance_date`

**Source:** `mtln_ods_performance`

---

## 7. Sequences

### Purpose

Generate unique surrogate keys for Silver/ODS tables.

### Naming Convention

`mtln_ods_<entity>_seq`

### DDL Pattern

```sql
CREATE OR REPLACE SEQUENCE mtln_ods_<entity>_seq
    START = 1
    INCREMENT = 1
    COMMENT = 'Surrogate key generator for mtln_ods_<entity>';
```

### Sequences

1. **mtln_ods_campaigns_seq** - For mtln_ods_campaigns.surrogate_key
2. **mtln_ods_customers_seq** - For mtln_ods_customers.surrogate_key
3. **mtln_ods_products_seq** - For mtln_ods_products.surrogate_key
4. **mtln_ods_sales_seq** - For mtln_ods_sales.surrogate_key
5. **mtln_ods_performance_seq** - For mtln_ods_performance.surrogate_key
6. **mtln_ods_channels_seq** - For mtln_ods_channels.surrogate_key

### Usage in Table DDL

```sql
surrogate_key NUMBER(38,0) DEFAULT mtln_ods_<entity>_seq.NEXTVAL
```

**Benefits:**
- Automatic key generation (no pipeline logic)
- Guaranteed uniqueness
- Preserved on UPDATE (MERGE)
- Snowflake best practice

---

## 8. Quick Reference

### 8.1 Object Summary

| Layer | Objects | Total Columns | Purpose |
|-------|---------|---------------|----------|
| **RAW** | 6 stages | N/A | File landing |
| **Bronze** | 6 tables | 66 | Raw relational |
| **Silver/ODS** | 6 tables + 6 sequences | 72 | Clean operational |
| **Gold** | 7 views (5 dims + 2 facts) | 95 | Analytics star schema |
| **Total** | **31 objects** | **233 columns** | End-to-end data warehouse |

### 8.2 Key Relationships

```
mtln_fact_sales
  ├─ dim_customer_sk → mtln_dim_customer.dim_customer_sk
  ├─ dim_product_sk → mtln_dim_product.dim_product_sk
  ├─ dim_campaign_sk → mtln_dim_campaign.dim_campaign_sk
  └─ dim_date_sk → mtln_dim_date.date_key

mtln_fact_performance
  ├─ dim_campaign_sk → mtln_dim_campaign.dim_campaign_sk
  ├─ dim_channel_sk → mtln_dim_channel.dim_channel_sk
  └─ dim_date_sk → mtln_dim_date.date_key
```

### 8.3 Load Frequency

| Table | Load Strategy | Frequency | Duration |
|-------|---------------|-----------|----------|
| Bronze | Full refresh | Daily 2:00 AM | 5 min |
| Silver/ODS | Incremental | Daily 2:00 AM | 5 min |
| Gold | Views | Real-time | Instant |

### 8.4 Data Volume Estimates

| Table | Current Rows | Monthly Growth | 1-Year Projection |
|-------|-------------|----------------|-------------------|
| mtln_ods_campaigns | 1,000 | 100 | 2,200 |
| mtln_ods_customers | 500,000 | 5,000 | 560,000 |
| mtln_ods_products | 10,000 | 200 | 12,400 |
| mtln_ods_sales | 5,000,000 | 400,000 | 9,800,000 |
| mtln_ods_performance | 500,000 | 40,000 | 980,000 |
| mtln_ods_channels | 20 | 1 | 32 |
| **Total ODS** | **6,011,020** | **445,301** | **11,354,632** |

### 8.5 Storage Estimates

| Layer | Tables | Size (Current) | Size (1 Year) |
|-------|--------|----------------|----------------|
| Bronze (TRANSIENT) | 6 | 1.2 GB | 2.5 GB |
| Silver/ODS | 6 | 3.0 GB | 6.2 GB |
| Gold (views) | 7 | 0 GB | 0 GB |
| **Total** | **19** | **4.2 GB** | **8.7 GB** |

**Notes:**
- Bronze/Silver purged per retention policy
- Gold has no storage (views)
- Estimates based on Parquet compression (~10:1)

---

## Appendix: Common Queries

### A.1 Check Row Counts

```sql
SELECT 'Bronze' AS layer, 'campaigns' AS entity, COUNT(*) AS row_count FROM mtln_bronze_campaigns
UNION ALL
SELECT 'Silver', 'campaigns', COUNT(*) FROM mtln_ods_campaigns
UNION ALL
SELECT 'Gold', 'dim_campaign', COUNT(*) FROM mtln_dim_campaign
ORDER BY layer, entity;
```

### A.2 Verify Foreign Key Integrity

```sql
-- Orphaned sales records (no matching customer)
SELECT COUNT(*)
FROM mtln_fact_sales f
LEFT JOIN mtln_dim_customer c ON f.dim_customer_sk = c.dim_customer_sk
WHERE c.dim_customer_sk IS NULL;
-- Should return 0
```

### A.3 Check Data Freshness

```sql
SELECT 
    'campaigns' AS table_name,
    MAX(load_timestamp) AS last_load,
    DATEDIFF(hour, MAX(load_timestamp), CURRENT_TIMESTAMP()) AS hours_since_load
FROM mtln_ods_campaigns;
-- Should be < 24 hours
```

---

**Document Version:** 1.0  
**Last Updated:** 2025-12-21  
**Status:** ✅ Ready for Implementation

**Next Steps:**  
→ Use this dictionary to build DDL pipeline  
→ Reference during pipeline development  
→ Update as schema evolves  

---

*For technical implementation, see [ARCHITECTURE-LLD.md](./ARCHITECTURE-LLD.md)*